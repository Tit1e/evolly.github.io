<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>axios 直传七牛问题 · Tit1e</title><meta name="description" content="axios 直传七牛问题 - Tit1e"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/Tit1e/atom.xml" title="Tit1e"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">过往</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">订阅</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">axios 直传七牛问题</h1><div class="post-info">Mar 8, 2020</div><div class="post-content"><p>前几天遇到了这样一个需求：监听粘贴事件，将粘贴板中的文件上传至七牛。</p>
<p>这个需求的实现过程我会另开一片文章，这篇文章主要用来记录我在使用 axios 直传七牛的过程中遇到的问题。</p>
<p>我本想这不是很简单：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData()</span><br><span class="line">  formData.append(<span class="string">'file'</span>, file)</span><br><span class="line">  formData.append(<span class="string">'token'</span>, <span class="keyword">this</span>.token)</span><br><span class="line">  formData.append(<span class="string">'key'</span>, <span class="keyword">this</span>.key)</span><br><span class="line">  axios.post(<span class="string">'url'</span>, formData).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// code......</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果返回的却是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;error: "invalid multipart format: no multipart boundary param in Content-Type"&#125;</span><br></pre></td></tr></table></figure>
<p>然后我就开始在网上搜，试着改了 <code>Content-Type</code>，但还是没用，最后我在<a href="https://blog.qiatia.cn/2019/05/18/Axios/" target="_blank" rel="noopener">这里</a>找到了与我遇到相同问题的人，于是我用他的方法试了一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> $axios = axios.create(&#123; <span class="attr">withCredentials</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData()</span><br><span class="line">  formData.append(<span class="string">'file'</span>, file)</span><br><span class="line">  formData.append(<span class="string">'token'</span>, <span class="keyword">this</span>.token)</span><br><span class="line">  formData.append(<span class="string">'key'</span>, <span class="keyword">this</span>.key)</span><br><span class="line">  $axios(&#123;</span><br><span class="line">    url: <span class="string">'url'</span>,</span><br><span class="line">    data: formData,</span><br><span class="line">    method: <span class="string">'post'</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// code......</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果果然成功了！</p>
<p>不过发生了个诡异的事情，在我写这篇文章的时候，我想重新复现一下问题，结果发现我上面直接使用 <code>axios.post</code> 也可以正常上传了，但前几天在试的时候的确是返回错误信息的！所以我现在有点怀疑人生。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/02/27/123-webpack4-clean-webpack-plugin/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2020 <a href="https://github.com/Tit1e" target="_blank">Tit1e</a>, powered by <a href="https://github.com/Tit1e/hexo-theme-simple" target="_blank">hexo-theme-simple</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>